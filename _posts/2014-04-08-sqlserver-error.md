---
layout: post
title:  那些年学习SQL Server遇到的报错信息
date:   2014-04-08 01:51:00
categories: sqlserver
tags:   sqlserver
---
##No.1
初次接触SQL Server，在建立一个新表并设置主键之后保存，发现SQL Server提示“不允许保存更改”，因为“您所做的更改要求删除并重新创建以下表”。

经过查资料，发现原来是SQL Server默认选项下禁止更改表结构的操作。解决方式很简单，打开“工具”菜单栏，点击“选项”，在“设计器”栏目“表设计器和数据库设计器”子栏目里有一个选项“阻止保存要求重新创建表的更改”，把前面的勾选去掉就好了。这次的体会是SQL Server大概是个默认设置相当保守的数据库，至少默认阻止一切更改表结构的操作，连设置主键这种最基本的操作都要阻止。

##No.2
在移动/改名数据库的.mdf数据库文件和.ldf日志文件之后，往往需要重新导入。导入数据库的通常方法是在“对象资源管理器”的“数据库”上单击右键，选择“附加”，然后选择要附加的.mdf文件就好了。然而包括我在内的很多人遇到了一个错误信息“操作系统错误 5:(拒绝访问), Error: 5120 ”。

很快锁定是访问权限不够高的问题，通过比对系统数据库和想导入的数据库的权限，发现系统数据库多了“MSSQLSERVER”和“OWNER RIGHT”两个账户的完全访问权限，然而添加之后依然报错，只是有时报错变成了“操作系统错误 2:(找不到文件), Error: 5120 ”。翻遍资料在一个隐秘的角落发现有人提到把“Authenticated Users”账户权限从修改提升到完全访问，死马当活马医，没想到成功导入。

导入成功后再看已导入的数据库权限信息，发现已被自动修改，只剩下“Administrators”、“MSSQLSERVER”、“OWNER RIGHT”三个完全访问权限账户。其中的奥秘尚待日后琢磨。总之这次的经验是SQL Server是个强安全性的数据库，与NT架构和NTFS文件系统在安全性上互相配合，相得益彰；然而有时过于复杂的安全性设定会导致一些麻烦，需要留神。